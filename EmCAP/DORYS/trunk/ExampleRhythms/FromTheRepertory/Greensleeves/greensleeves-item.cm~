;;; -*- Lisp -*-
;;; Greensleeves in 6/8 time, taken from Roberts ICMC'94, pp 127.
;;; Individual item streams from a quantised greensleeves rhythm
;;; transcription, producing a collection of rhythm generators for
;;; wavelet analysis and playback.


;; Define our rhythm in terms of musical rhythmic values.
(setf greensleeves-rhythm (rhythms
; upbeat?
e
; first bar
q e e. s e
; second bar 
q e e. s e
; third bar
q e e e e
; fourth bar
q e q e
; repeat of first two bars
q e e. s e
; sixth bar 
q e e. s e
; seventh bar
e. s e e e e
; eigth bar
q. q.
;; Reprise
q. e. s e
; repeat of bar 2 & 3 rhythm
q e e. s e
; 
q e e. s e
;
q e q.
;; Repeat of Reprise
q. e. s e
; and bar 2
q e e. s e
; shorten the crochet to become dotted quaver to syncopate the rhythm. 
e. s e e. s e
;
q. q. tempo 60.0))


;; Define our accent structure
(setf greensleeves-downbeat-intensity (amplitudes
; upbeat
  0.75
; first bar
  0.95 0.75 0.75 0.75 0.75 
; second bar
  0.95 0.75 0.75 0.75 0.75 
; third bar
  0.95 0.75 0.75 0.75 0.75 
; fourth bar
  0.95 0.75 0.75 0.75 
; fifth bar
  0.95 0.75 0.75 0.75 0.75 
; sixth bar
  0.95 0.75 0.75 0.75 0.75 
; seventh bar
  0.95 0.75 0.75 0.75 0.75 0.75 
; eigth bar
  0.95 0.75
;; Reprise compare how close the accent structure matches the earlier rhythm
0.95 0.75 0.75 0.75
; repeat of bar 2 & 3 rhythm
0.95 0.75 0.75 0.75 0.75 
; 
0.95 0.75 0.75 0.75 0.75 
;
0.95 0.75 0.75 
;; Repeat of Reprise
0.95 0.75 0.75 0.75 
; and bar 2
0.95 0.75 0.75 0.75 0.75 
; 
0.95 0.75 0.75 0.75 0.75 0.75
;
0.95 0.75))

;; Define our melody
(setf greensleeves-melody (notes
FS4 A4 B4 CS5
D5 CS5 B4 GS4 
E4 FS4 GS4 A4 
FS4 FS4 F4 FS4 
GS4 F4 CS4 FS4 
A4 B4 CS5 D5 
CS5 B4 GS4 E4 
FS4 GS4 A4 GS4 
FS4 F4 DS4 F4 FS4 FS4
;; Reprise
e5 e5 ds5 cs5 b4 gs4 e4 fs4 gs4 a4 fs4 fs4 f4 fs4 gs4 f4 cs4
;; second reprise
e5 e5 ds5 cs5 b4 gs4 e4 fs4 gs4 a4 gs4 fs4 f4 ds4 f4 fs4 fs4))

;;; Now the various species of sequences derived from the item-streams
;;; defined above.

;;; A rhythm-onset version of the quantised greensleeves rhythm,
;;; with an accent. Should produce greensleeves_accent.snd/text
;;; in 6/8 time, taken from Roberts ICMC'94, pp 127
;;; We use the 39th beat so we get the full distance, thus making it a
;;; properly repeated analysis window
(generator greensleeves-accent-generator rhythm-onset ; rhythm-bowed-tone 
	(length 38)
	   (setf note (item greensleeves-melody :kill t))
	   (setf amplitude (item greensleeves-downbeat-intensity))
	   (setf rhythm (item greensleeves-rhythm))
	   (setf duration rhythm))

;;; This version removes the anacrusis
(generator greensleeves-accent-no-anacrusis rhythm-onset ; rhythm-bowed-tone 
	(length 38)
	   (setf note (item greensleeves-melody :kill t))
	   (setf amplitude (item greensleeves-downbeat-intensity))
	   (setf rhythm (item greensleeves-rhythm))
	   (setf duration rhythm))


;; This version generates a much cleaner scalogram because we end early
(generator greensleeves-accent-early-end rhythm-onset ; rhythm-bowed-tone 
	(length 38)
	   (setf note (item greensleeves-melody :kill t))
	   (setf amplitude (item greensleeves-downbeat-intensity))
	   (setf rhythm (item greensleeves-rhythm))
	   (setf duration (/ rhythm 2)))


;;; A rhythm-onset version of the quantised greensleeves rhythm,
;;; with equal amplitude. Should produce greensleeves_unaccent.snd/text
(generator greensleeves-unaccented rhythm-onset
	   (amplitude 0.75 length 38)
	   (setf note (item greensleeves-melody :kill t))
	   (setf rhythm (item greensleeves-rhythm))
	   (setf duration rhythm))

;;; A MIDI-note version of the melody together with the accented
;;; rhythm to produce a playable tune
(generator greensleeves-accented-melody midi-note ()
	   (setf note (item greensleeves-melody :kill t))
	   (setf amplitude (item greensleeves-downbeat-intensity))
	   (setf rhythm (item greensleeves-rhythm))
	   (setf duration (/ rhythm 2)))

;;; A rhythm-gaussian version of the quantised greensleeves rhythm,
;;; with an accent. Should produce greensleeves_accent.snd/text
;;; First tried with rhythm-gaussian instrument (a rectified Gaussian alone)
;;; Currently with rhythm-gaussian-tone, using a fixed frequency
;;; (100Hz) 
;(generator greensleeves-gaussian-accented rhythm-gaussian-tone (note 'c4))

;;; A rhythm-onset version of the quantised greensleeves rhythm,
;;; with an accent and a structurally important beat missing.
;;; Should produce greensleeves_accent_missing.snd/text
;(generator greensleeves-accent-missing rhythm-onset (note 'c4)
;(setf note (item greensleeves-melody))
;(setf rhythm (item greensleeves-missing-rhythm))
;)

